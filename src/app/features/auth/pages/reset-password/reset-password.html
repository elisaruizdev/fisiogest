<div class="login-form">
    <header class="login-form__header">
        <h2 class="login-form__title">Nueva contraseña</h2>
        <p class="login-form__subtitle">
            Introduce tu nueva contraseña para acceder a la plataforma
        </p>
    </header>

    @if (!passwordReset()) {
    <form class="login-form__form" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
        <div class="login-form__field">
            <label class="login-form__label" for="password">Nueva contraseña</label>
            <div class="login-form__input-wrapper">
                <input class="login-form__input" type="password" id="password" formControlName="password"
                    placeholder="Mínimo 8 caracteres" />
            </div>
            @if (resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched) {
            <span class="login-form__error">
                La contraseña debe tener al menos 8 caracteres, una mayúscula, una minúscula y un número
            </span>
            }
        </div>

        <div class="login-form__field">
            <label class="login-form__label" for="confirmPassword">Confirmar contraseña</label>
            <div class="login-form__input-wrapper">
                <input class="login-form__input" type="password" id="confirmPassword" formControlName="confirmPassword"
                    placeholder="Repite tu contraseña" />
            </div>
            @if (resetPasswordForm.hasError('passwordMismatch') && resetPasswordForm.get('confirmPassword')?.touched) {
            <span class="login-form__error">
                Las contraseñas no coinciden
            </span>
            }
        </div>

        @if (errorMessage()) {
        <div class="login-form__error-box">
            {{ errorMessage() }}
        </div>
        }

        <button type="submit" class="login-form__button" [disabled]="resetPasswordForm.invalid || isLoading()">
            {{ isLoading() ? 'Actualizando...' : 'Cambiar contraseña' }}
        </button>
    </form>
    }

    @if (passwordReset()) {
    <div class="login-form__success">
        <p class="login-form__success-message">
            ✓ Contraseña actualizada correctamente
        </p>
        <p class="login-form__success-submessage">
            Ya puedes iniciar sesión con tu nueva contraseña.
        </p>

        <a routerLink="/login" class="login-form__button"
            style="text-align: center; display: block; text-decoration: none;">
            Ir al login
        </a>
    </div>
    }
</div>