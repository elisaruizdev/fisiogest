<div class="notifications">

    <!-- Botón de notificaciones -->
    <button mat-icon-button class="notifications__trigger" [matMenuTriggerFor]="notificationsMenuRef"
        aria-label="Notificaciones">

        <mat-icon [matBadge]="notificationCount" [matBadgeHidden]="notificationCount === 0" matBadgeColor="warn"
            matBadgeSize="small" aria-hidden="false" class="notifications__icon">
            notifications
        </mat-icon>

    </button>

    <!-- Menú desplegable -->
    <mat-menu #notificationsMenuRef="matMenu" class="notifications__dropdown">

        <!-- Header -->
        <div class="notifications__header" mat-menu-item disabled>
            <span class="notifications__title">Notificaciones</span>
            @if(notifications.length > 0) {
            <button mat-button class="notifications__clear-all" (click)="onClearAll()">
                Limpiar todo
            </button>
            }
        </div>

        <mat-divider class="notifications__divider"></mat-divider>

        <!-- Lista de notificaciones -->
        <div class="notifications__list">

            @if(notifications.length > 0) {
            <!-- Cuando hay notificaciones -->
            @for(notification of notifications; track trackByNotification($index, notification)) {
            <button mat-menu-item class="notifications__item"
                [class.notifications__item--warning]="notification.type === 'warning'"
                [class.notifications__item--error]="notification.type === 'error'"
                [class.notifications__item--success]="notification.type === 'success'"
                (click)="onNotificationClick(notification)">

                <mat-icon class="notifications__item-icon">
                    {{notification.icon}}
                </mat-icon>

                <div class="notifications__item-content">
                    <div class="notifications__item-message">
                        {{notification.message}}
                    </div>
                    @if(notification.timestamp) {
                    <div class="notifications__item-time">
                        {{notification.timestamp | date:'short'}}
                    </div>
                    }
                </div>

                <button mat-icon-button class="notifications__item-close"
                    (click)="onDismissNotification($event, notification)" aria-label="Descartar notificación">
                    <mat-icon>close</mat-icon>
                </button>

            </button>
            }
            } @else {
            <!-- Cuando no hay notificaciones -->
            <div class="notifications__empty" mat-menu-item disabled>
                <mat-icon class="notifications__empty-icon">notifications_off</mat-icon>
                <span class="notifications__empty-text">
                    No hay notificaciones
                </span>
            </div>
            }

        </div>

        <!-- Footer -->
        @if(notifications.length > 3) {
        <mat-divider class="notifications__divider"></mat-divider>

        <button mat-menu-item class="notifications__view-all" (click)="onViewAll()">
            <mat-icon class="notifications__view-all-icon">list</mat-icon>
            Ver todas las notificaciones
        </button>
        }

    </mat-menu>

</div>